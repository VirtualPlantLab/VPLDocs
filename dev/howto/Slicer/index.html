<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using the slicer · Virtual Plant Laboratory</title><meta name="title" content="Using the slicer · Virtual Plant Laboratory"/><meta property="og:title" content="Using the slicer · Virtual Plant Laboratory"/><meta property="twitter:title" content="Using the slicer · Virtual Plant Laboratory"/><meta name="description" content="Documentation for Virtual Plant Laboratory."/><meta property="og:description" content="Documentation for Virtual Plant Laboratory."/><meta property="twitter:description" content="Documentation for Virtual Plant Laboratory."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Virtual Plant Laboratory</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Virtual Plant Laboratory</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../manual/Julia/">Julia basic concepts</a></li><li><a class="tocitem" href="../../manual/Graphs/">Dynamic graph creation and manipulation</a></li><li><a class="tocitem" href="../../manual/Geometry/Primitives/">Geometry primitives</a></li><li><a class="tocitem" href="../../manual/Geometry/Turtle/">Turtle geometry and scenes</a></li><li><a class="tocitem" href="../../manual/Raytracer/">Ray tracing</a></li><li><a class="tocitem" href="../../manual/Visualization/">3D visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/intro_tut/">Intro</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Getting started with VPL</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/getting_started/algae/">Algae growth</a></li><li><a class="tocitem" href="../../tutorials/getting_started/snowflakes/">The Koch snowflake</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">From tree to forest</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/from_tree_forest/tree/">Tree</a></li><li><a class="tocitem" href="../../tutorials/from_tree_forest/forest/">Forest</a></li><li><a class="tocitem" href="../../tutorials/from_tree_forest/growthforest/">Growth forest</a></li><li><a class="tocitem" href="../../tutorials/from_tree_forest/raytracedforest/">Ray-traced forest</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">More on rules and queries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/more_rules_queries/context/">Context sensitive rules</a></li><li><a class="tocitem" href="../../tutorials/more_rules_queries/relationalqueries/">Relational queries</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../GridCloner/">Setting up a grid cloner</a></li><li><a class="tocitem" href="../Message/">Messages in scenes</a></li><li><a class="tocitem" href="../Materials/">Multiple materials/colors</a></li><li><a class="tocitem" href="../Traversal/">Advanced traversal</a></li><li><a class="tocitem" href="../Coordinates/">Absolute coordinates</a></li><li><a class="tocitem" href="../LightSources/">Creating light sources</a></li><li class="is-active"><a class="tocitem" href>Using the slicer</a><ul class="internal"><li><a class="tocitem" href="#Slicing-a-rectangle-with-a-single-plane"><span>Slicing a rectangle with a single plane</span></a></li><li><a class="tocitem" href="#Slicing-a-rectangle-with-multiple-planes"><span>Slicing a rectangle with multiple planes</span></a></li><li><a class="tocitem" href="#Slicing-geometry-inside-the-feed!-method"><span>Slicing geometry inside the <code>feed!</code> method</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../api/graphs/">Graphs</a></li><li><a class="tocitem" href="../../api/geometry/">Scenes and 3D meshes</a></li><li><a class="tocitem" href="../../api/turtle/">Turtle geometry</a></li><li><a class="tocitem" href="../../api/raytracer/">Ray tracing</a></li><li><a class="tocitem" href="../../api/viz/">3D visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">VPLVerse</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">SkyDomes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../VPLVerse/SkyDomes/">SkyDomes package</a></li><li><a class="tocitem" href="../../VPLVerse/SkyDomes/API/">SkyDomes API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Ecophys</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../VPLVerse/Ecophys/">Ecophys package</a></li><li><a class="tocitem" href="../../VPLVerse/Ecophys/photosynthesis/">Photosynthesis API</a></li><li><a class="tocitem" href="../../VPLVerse/Ecophys/growth/">Growth API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">PlantSimEngine</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../VPLVerse/PlantSimEngine/">PlantSimEngine package</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">PlantBioPhysics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../VPLVerse/PlantBioPhysics/">PlantBioPhysics package</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../developers/organization/">Internal organization</a></li><li><a class="tocitem" href="../../developers/use&amp;dev_packages/">Package and Environment Management for VPL</a></li><li><a class="tocitem" href="../../developers/style/">Styling protocol</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How-to guides</a></li><li class="is-active"><a href>Using the slicer</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using the slicer</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/VPLDocs/blob/master/docs/src/howto/Slicer.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Slicing-a-mesh-by-planes"><a class="docs-heading-anchor" href="#Slicing-a-mesh-by-planes">Slicing a mesh by planes</a><a id="Slicing-a-mesh-by-planes-1"></a><a class="docs-heading-anchor-permalink" href="#Slicing-a-mesh-by-planes" title="Permalink"></a></h1><p>Alejandro Morales</p><p>Centre for Crop Systems Analysis - Wageningen University</p><p>In this example we will learn how to use the slicer functionality to modify existing meshes according to specific slicing planes. The idea of the slicer is to cut a mesh by one or more planes, generating a new version of the mesh such that none the triangles intersect with the planes. For example, if we use multiple horizontal planes (to define layers in the soil or aboveground) this wil result in any triangle in the new mesh belonging to only one layer. The slicer can be used when modeling plant-environment interactions, since the physics of the environment will often be simulated in layers or voxels, though the user is free to apply in other contexts.</p><p>To introduce the use of the slicer, we will first create a simple mesh and then slice it using a single plane. A more detailed example will be provided in the next section.</p><h2 id="Slicing-a-rectangle-with-a-single-plane"><a class="docs-heading-anchor" href="#Slicing-a-rectangle-with-a-single-plane">Slicing a rectangle with a single plane</a><a id="Slicing-a-rectangle-with-a-single-plane-1"></a><a class="docs-heading-anchor-permalink" href="#Slicing-a-rectangle-with-a-single-plane" title="Permalink"></a></h2><p>Let&#39;s start by creating a simple rectangle.</p><pre><code class="language-julia hljs">using VirtualPlantLab
r = Rectangle(length = 1.0, width = 1.0)</code></pre><p>We can check that the rectangle is implemented as two triangles:</p><pre><code class="language-julia hljs">ntriangles(r)</code></pre><p>Now we will slice it by a horizontal plane at 0.5 units above the origin. We will use the function <code>slice!</code> and specify the plane as <code>Z = 0.5</code>:</p><pre><code class="language-julia hljs">slice!(r, Z = 0.5)</code></pre><p>We can check that the rectangle has been sliced into six triangles (each of the original triangles has been split into three):</p><pre><code class="language-julia hljs">ntriangles(r)</code></pre><p>The slicer adds a property <code>slices</code> to the mesh, which indicates to which layer or voxel each triangle belongs to:</p><pre><code class="language-julia hljs">properties(r)[:slices]</code></pre><p>As you can see, each triangle has been assigned three numbers, corresponding to the their position relative to slicing planes perpendicular to the X, Y and Z axis respectively. A <code>0</code> implies no actual slicing in a particular dimension (in this case both <code>X</code> and <code>Y</code>). For <code>Z</code> axis, we have a <code>1</code> for the triangles below the slicing plane (first layer) and a <code>2</code> for the triangles above the plane (second layer).</p><p>To visualize the results, let&#39;s color each triangle according to the layer it belongs to:</p><pre><code class="language-julia hljs">import ColorTypes: RGB
colors = [RGB(1, 0, 0), RGB(0, 1, 0)]
all_colors = RGB{Float64}[]
for slice in properties(r)[:slices]
    push!(all_colors, colors[slice[3]])
end
add_property!(r, :colors, all_colors)</code></pre><p>And now we can render the results:</p><pre><code class="language-julia hljs">import GLMakie
render(r)</code></pre><h2 id="Slicing-a-rectangle-with-multiple-planes"><a class="docs-heading-anchor" href="#Slicing-a-rectangle-with-multiple-planes">Slicing a rectangle with multiple planes</a><a id="Slicing-a-rectangle-with-multiple-planes-1"></a><a class="docs-heading-anchor-permalink" href="#Slicing-a-rectangle-with-multiple-planes" title="Permalink"></a></h2><p>Let&#39;s repeat the previous example but now we slice the rectangly with multiple planes along the <code>Y</code> and <code>Z</code> axes. Note how we can pass an array of values to the <code>slice!</code> function:</p><pre><code class="language-julia hljs">r = Rectangle(length = 1.0, width = 1.0)
Ycuts = collect(-0.25:0.25:0.5)
ny = length(Ycuts)
Zcuts = collect(0.25:0.25:1)
nz = length(Zcuts)
slice!(r, Y = Ycuts, Z = Zcuts);</code></pre><p>We now have a large number of triangles:</p><pre><code class="language-julia hljs">ntriangles(r)</code></pre><p>We can visualize the results as before, assigning a random color to each pixel that results from the intersection of the slicing planes. Notice that now we have to use the second and third elements of the <code>slice</code> array to identify the exact location of the triangle in the grid of pixels:</p><pre><code class="language-julia hljs">colors = rand(RGB, ny, nz)
all_colors = RGB{Float64}[]
for slice in properties(r)[:slices]
    push!(all_colors, colors[slice[2], slice[3]])
end
add_property!(r, :colors, all_colors)
render(r)</code></pre><h2 id="Slicing-geometry-inside-the-feed!-method"><a class="docs-heading-anchor" href="#Slicing-geometry-inside-the-feed!-method">Slicing geometry inside the <code>feed!</code> method</a><a id="Slicing-geometry-inside-the-feed!-method-1"></a><a class="docs-heading-anchor-permalink" href="#Slicing-geometry-inside-the-feed!-method" title="Permalink"></a></h2><p>Using the slicer inside a <code>feed!</code> method is straightforward, though it requires some adjustments. Firstly, we do not know a priori the number of triangles that will result from the slicing, so we need to adjust the way we store colors or optical properties. Secondly, we cannot add a geometric primitive directly to the turtle, as that will prevents use from applying the slicer to it. Instead, we need to create a local version of the primitive, slice it, add any properties we want to store (adjusting to the actual number of triangles) and then feed it to the turtle using the more generic <code>Mesh!()</code>.</p><p>Let&#39;s illustrate this with an example reusing the rectangle we created before. This time the rectangle represents the geometry of a node in a graph (e.g. a leaf of a plant or a soil tile).</p><p>As usual, we create a module to contain the data structure and associated methods:</p><pre><code class="language-julia hljs">module MyRectangle
    using VirtualPlantLab
    import ColorTypes: RGB

    # Object that will be rendered as rectangle
    struct Tile &lt;: Node
        length::Float64
        width::Float64
        colors::Matrix{RGB{Float64}}
    end

    function VirtualPlantLab.feed!(turtle::Turtle, t::Tile, data)
        # Create the rectangle
        r = Rectangle(turtle, length = t.length, width = t.width)
        # Slice it (YCUTS and XCUTS are global variables, could be in data too)
        slice!(r, Y = YCUTS, Z = ZCUTS)
        # Add the colors (the colors per pixel are stored in the node)
        all_colors = RGB{Float64}[]
        for slice in properties(r)[:slices]
            push!(all_colors, t.colors[slice[2], slice[3]])
        end
        # Add the mesh to the turtle while defining the colors as properties
        Mesh!(turtle, r, colors = all_colors)
        return nothing
    end

    # Define the cuts and functions to modify them
    YCUTS::Vector{Float64} = collect(-0.25:0.25:0.5)
    set_ycuts!(cuts) = (global YCUTS = cuts)
    ZCUTS::Vector{Float64} = collect(0.25:0.25:1)
    set_zcuts!(cuts) = (global ZCUTS = cuts)
end</code></pre><p>Let&#39;s now create a simple static graph and make sure that we can generate the rectangular tile:</p><pre><code class="language-julia hljs">import .MyRectangle as MR
nz = length(MR.ZCUTS)
ny = length(MR.YCUTS)
graph = Graph(axiom = MR.Tile(1.0, 1.0, rand(RGB, ny, nz)))
render(Mesh(graph))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../LightSources/">« Creating light sources</a><a class="docs-footer-nextpage" href="../../api/graphs/">Graphs »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 17 July 2025 14:50">Thursday 17 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
