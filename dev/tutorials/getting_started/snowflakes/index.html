<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The Koch snowflake · Virtual Plant Laboratory</title><meta name="title" content="The Koch snowflake · Virtual Plant Laboratory"/><meta property="og:title" content="The Koch snowflake · Virtual Plant Laboratory"/><meta property="twitter:title" content="The Koch snowflake · Virtual Plant Laboratory"/><meta name="description" content="Documentation for Virtual Plant Laboratory."/><meta property="og:description" content="Documentation for Virtual Plant Laboratory."/><meta property="twitter:description" content="Documentation for Virtual Plant Laboratory."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Virtual Plant Laboratory</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Virtual Plant Laboratory</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox"/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../manual/Julia/">Julia basic concepts</a></li><li><a class="tocitem" href="../../../manual/Graphs/">Dynamic graph creation and manipulation</a></li><li><a class="tocitem" href="../../../manual/Geometry/Primitives/">Geometry primitives</a></li><li><a class="tocitem" href="../../../manual/Geometry/Turtle/">Turtle geometry and scenes</a></li><li><a class="tocitem" href="../../../manual/Raytracer/">Ray tracing</a></li><li><a class="tocitem" href="../../../manual/Visualization/">3D visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../intro_tut/">Intro</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox" checked/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Getting started with VPL</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../algae/">Algae growth</a></li><li class="is-active"><a class="tocitem" href>The Koch snowflake</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Other-snowflake-fractals"><span>Other snowflake fractals</span></a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">From tree to forest</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../from_tree_forest/tree/">Tree</a></li><li><a class="tocitem" href="../../from_tree_forest/forest/">Forest</a></li><li><a class="tocitem" href="../../from_tree_forest/growthforest/">Growth forest</a></li><li><a class="tocitem" href="../../from_tree_forest/raytracedforest/">Ray-traced forest</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">More on rules and queries</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../more_rules_queries/context/">Context sensitive rules</a></li><li><a class="tocitem" href="../../more_rules_queries/relationalqueries/">Relational queries</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How-to guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../howto/GridCloner/">Setting up a grid cloner</a></li><li><a class="tocitem" href="../../../howto/Message/">Messages in scenes</a></li><li><a class="tocitem" href="../../../howto/Materials/">Multiple materials/colors</a></li><li><a class="tocitem" href="../../../howto/Traversal/">Advanced traversal</a></li><li><a class="tocitem" href="../../../howto/Coordinates/">Absolute coordinates</a></li><li><a class="tocitem" href="../../../howto/LightSources/">Creating light sources</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/graphs/">Graphs</a></li><li><a class="tocitem" href="../../../api/geometry/">Scenes and 3D meshes</a></li><li><a class="tocitem" href="../../../api/turtle/">Turtle geometry</a></li><li><a class="tocitem" href="../../../api/raytracer/">Ray tracing</a></li><li><a class="tocitem" href="../../../api/viz/">3D visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">VPLVerse</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">SkyDomes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../VPLVerse/SkyDomes/">SkyDomes package</a></li><li><a class="tocitem" href="../../../VPLVerse/SkyDomes/API/">SkyDomes API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Ecophys</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../VPLVerse/Ecophys/">Ecophys package</a></li><li><a class="tocitem" href="../../../VPLVerse/Ecophys/photosynthesis/">Photosynthesis API</a></li><li><a class="tocitem" href="../../../VPLVerse/Ecophys/growth/">Growth API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">PlantSimEngine</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../VPLVerse/PlantSimEngine/">PlantSimEngine package</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-4" type="checkbox"/><label class="tocitem" for="menuitem-6-4"><span class="docs-label">PlantBioPhysics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../VPLVerse/PlantBioPhysics/">PlantBioPhysics package</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Developers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../developers/organization/">Internal organization</a></li><li><a class="tocitem" href="../../../developers/use&amp;dev_packages/">Package and Environment Management for VPL</a></li><li><a class="tocitem" href="../../../developers/style/">Styling protocol</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Getting started with VPL</a></li><li class="is-active"><a href>The Koch snowflake</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The Koch snowflake</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/VPLDocs/blob/master/docs/src/tutorials/getting_started/snowflakes.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-Koch-snowflake"><a class="docs-heading-anchor" href="#The-Koch-snowflake">The Koch snowflake</a><a id="The-Koch-snowflake-1"></a><a class="docs-heading-anchor-permalink" href="#The-Koch-snowflake" title="Permalink"></a></h1><p>Alejandro Morales &amp; Ana Ernst</p><p>Centre for Crop Systems Analysis - Wageningen University</p><blockquote><h3>TL;DR</h3><ul><li>Define parameter for graph nodes</li><li>Define methods for VirtualPlantLab.feed! functions</li><li>Create <a href="https://virtualplantlab.com/dev/manual/Geometry/Turtle/#Scenes">Scenes</a></li><li><a href="https://virtualplantlab.com/dev/manual/Visualization/">Visualization</a> of &#39;Graph&#39; with render()</li></ul></blockquote><p>In this example, we create a Koch snowflake, which is one of the earliest fractals to be described. The Koch snowflake is a closed curve composed on multiple of segments of different lengths. Starting with an equilateral triangle, each segment in the snowflake is replaced by four segments of smaller length arrange in a specific manner. Graphically, the first four iterations of the Koch snowflake construction process result in the following figures (the green segments are shown as guides but they are not part of the snowflake):</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/8/8e/KochFlake.png" alt="First four iterations fo Koch snowflake fractal"/></p><p>In order to implement the construction process of a Koch snowflake in VPL we need to understand how a 3D structure can be generated from a graph of nodes. VPL uses a procedural approach to generate of structure based on the concept of turtle graphics.</p><p>The idea behind this approach is to imagine a turtle located in space with a particular position and orientation. The turtle then starts consuming the different nodes in the graph (following its topological structure) and generates 3D structures as defined by the user for each type of node. The consumption of a node may also include instructions to move and/or rotate the turtle, which allows to alter the relative position of the different 3D structures described by a graph.</p><p>The construction process of the Koch snowflake in VPL could then be represented by the following axiom and rewriting rule:</p><p>axiom: E(L) + RU(120) + E(L) + RU(120) + E(L) rule:  E(L) → E(L/3) + RU(-60) + E(L/3) + RU(120) + E(L/3) + RU(-60) + E(L/3)</p><p>Where E represent and edge of a given length (given in parenthesis) and RU represents a rotation of the turtle around the upward axis, with angle of rotation given in parenthesis in hexadecimal degrees. The rule can be visualized as follows:</p><p><img src="https://python-with-science.readthedocs.io/en/latest/_images/koch_order_1.png" alt="Koch construction rule"/></p><p>Note that VPL already provides several classes for common turtle movements and rotations, so our implementation of the Koch snowflake only needs to define a class to implement the edges of the snowflake. This can be achieved as follows:</p><pre><code class="language-julia hljs">using VirtualPlantLab
import GLMakie ## Import rather than &quot;using&quot; to avoid masking Mesh
using ColorTypes ## To define colors for the rendering
module sn
    import VirtualPlantLab
    struct E &lt;: VirtualPlantLab.Node
        length::Float64
    end
end
import .sn</code></pre><p>Note that nodes of type E need to keep track of the length as illustrated in the above. The axiom is straightforward:</p><pre><code class="language-julia hljs">const L = 1.0
axiom = sn.E(L) + VirtualPlantLab.RU(120.0) + sn.E(L) + VirtualPlantLab.RU(120.0) + sn.E(L)</code></pre><p>The rule is also straightforward to implement as all the nodes of type E will be replaced in each iteration. However, we need to ensure that the length of the new edges is a calculated from the length of the edge being replaced. In order to extract the data stored in the node being replaced we can simply use the function data. In this case, the replacement function is defined and then added to the rule. This can make the code more readable but helps debugging and testing the replacement function.</p><pre><code class="language-julia hljs">function Kochsnowflake(x)
    L = data(x).length
    sn.E(L/3) + RU(-60.0) + sn.E(L/3) + RU(120.0) + sn.E(L/3) + RU(-60.0) + sn.E(L/3)
end
rule = Rule(sn.E, rhs = Kochsnowflake)</code></pre><p>The model is then created by constructing the graph</p><pre><code class="language-julia hljs">Koch = Graph(axiom = axiom, rules = Tuple(rule))</code></pre><p>In order to be able to generate a 3D structure we need to define a method for the function <code>VirtualPlantLab.feed!</code> (notice the need to prefix it with <code>VirtualPlantLab.</code> as we are going to define a method for this function). The method needs to two take two arguments, the first one is always an object of type Turtle and the second is an object of the type for which the method is defined (in this case, E).</p><p>The body of the method should generate the 3D structures using the geometry primitives provided by VPL and feed them to the turtle that is being passed to the method as first argument. In this case, we are going to represent the edges of the Koch snowflakes with cylinders, which can be generated with the <code>HollowCylinder!</code> function from VirtualPlantLab. Note that the <code>feed!</code> should return <code>nothing</code>, the turtle will be modified in place (hence the use of <code>!</code> at the end of the function as customary in the VPL community).</p><p>In order to render the geometry, we need assign a <code>color</code> (i.e., any type of color support by the package ColorTypes.jl). In this case, we just feed a basic <code>RGB</code> color defined by the proportion of red, green and blue. To make the figures more appealing, we can assign random values to each channel of the color to generate random colors.</p><pre><code class="language-julia hljs">function VirtualPlantLab.feed!(turtle::Turtle, e::sn.E, vars)
    HollowCylinder!(turtle, length = e.length, width = e.length/10,
                    height = e.length/10, move = true,
                    colors = RGB(rand(), rand(), rand()))
    return nothing
end</code></pre><p>Note that the argument <code>move = true</code> indicates that the turtle should move forward as the cylinder is generated a distance equal to the length of the cylinder. Also, the <code>feed!</code> method has a third argument called <code>vars</code>. This gives acess to the shared variables stored within the graph (such that they can be accessed by any node). In this case, we are not using this argument.</p><p>After defining the method, we can now call the function render on the graph to generate a 3D interactive image of the Koch snowflake in the current state</p><pre><code class="language-julia hljs">sc = Mesh(Koch)
render(sc, axes = false)</code></pre><p>This renders the initial triangle of the construction procedure of the Koch snowflake. Let&#39;s execute the rules once to verify that we get the 2nd iteration (check the figure at the beginning of this document):</p><pre><code class="language-julia hljs">rewrite!(Koch)
render(Mesh(Koch), axes = false)</code></pre><p>And two more times</p><pre><code class="language-julia hljs">for i in 1:3
    rewrite!(Koch)
end
render(Mesh(Koch), axes = false)</code></pre><h1 id="Other-snowflake-fractals"><a class="docs-heading-anchor" href="#Other-snowflake-fractals">Other snowflake fractals</a><a id="Other-snowflake-fractals-1"></a><a class="docs-heading-anchor-permalink" href="#Other-snowflake-fractals" title="Permalink"></a></h1><p>To demonstrate the power of this approach, let&#39;s create an alternative snowflake. We will simply invert the rotations of the turtle in the rewriting rule</p><pre><code class="language-julia hljs">function Kochsnowflake2(x)
   L = data(x).length
   sn.E(L/3) + RU(60.0) + sn.E(L/3) + RU(-120.0) + sn.E(L/3) + RU(60.0) + sn.E(L/3)
end
rule2 = Rule(sn.E, rhs = Kochsnowflake2)
Koch2 = Graph(axiom = axiom, rules = Tuple(rule2))</code></pre><p>The axiom is the same, but now the edges added by the rule will generate the edges towards the inside of the initial triangle. Let&#39;s execute the first three iterations and render the results First iteration</p><pre><code class="language-julia hljs">rewrite!(Koch2)
render(Mesh(Koch2), axes = false)</code></pre><p>Second iteration</p><pre><code class="language-julia hljs">rewrite!(Koch2)
render(Mesh(Koch2), axes = false)</code></pre><p>Third iteration</p><pre><code class="language-julia hljs">rewrite!(Koch2)
render(Mesh(Koch2), axes = false)</code></pre><p>This is know as <a href="https://mathworld.wolfram.com/KochAntisnowflake.html">Koch antisnowflake</a>. We could also easily generate a <a href="https://mathworld.wolfram.com/CesaroFractal.html">Cesàro fractal</a> by also changing the axiom:</p><pre><code class="language-julia hljs">axiomCesaro = sn.E(L) + RU(90.0) + sn.E(L) + RU(90.0) + sn.E(L) + RU(90.0) + sn.E(L)
Cesaro = Graph(axiom = axiomCesaro, rules = (rule2,))
render(Mesh(Cesaro), axes = false)</code></pre><p>And, as before, let&#39;s go through the first three iterations First iteration</p><pre><code class="language-julia hljs">rewrite!(Cesaro)
render(Mesh(Cesaro), axes = false)</code></pre><p>Second iteration</p><pre><code class="language-julia hljs">rewrite!(Cesaro)
render(Mesh(Cesaro), axes = false)</code></pre><p>Third iteration</p><pre><code class="language-julia hljs">rewrite!(Cesaro)
render(Mesh(Cesaro), axes = false)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../algae/">« Algae growth</a><a class="docs-footer-nextpage" href="../../from_tree_forest/tree/">Tree »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 17 December 2024 11:21">Tuesday 17 December 2024</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
