<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Turtle geometry and scenes · Virtual Plant Laboratory</title><meta name="title" content="Turtle geometry and scenes · Virtual Plant Laboratory"/><meta property="og:title" content="Turtle geometry and scenes · Virtual Plant Laboratory"/><meta property="twitter:title" content="Turtle geometry and scenes · Virtual Plant Laboratory"/><meta name="description" content="Documentation for Virtual Plant Laboratory."/><meta property="og:description" content="Documentation for Virtual Plant Laboratory."/><meta property="twitter:description" content="Documentation for Virtual Plant Laboratory."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">Virtual Plant Laboratory</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Virtual Plant Laboratory</a></li><li><input class="collapse-toggle" id="menuitem-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../Julia/">Julia basic concepts</a></li><li><a class="tocitem" href="../../Graphs/">Dynamic graph creation and manipulation</a></li><li><a class="tocitem" href="../Primitives/">Geometry primitives</a></li><li class="is-active"><a class="tocitem" href>Turtle geometry and scenes</a><ul class="internal"><li><a class="tocitem" href="#Meshes"><span>Meshes</span></a></li><li><a class="tocitem" href="#Turtle-geometry"><span>Turtle geometry</span></a></li><li><a class="tocitem" href="#Movement-operators"><span>Movement operators</span></a></li><li><a class="tocitem" href="#Scenes"><span>Scenes</span></a></li></ul></li><li><a class="tocitem" href="../../Raytracer/">Ray tracing</a></li><li><a class="tocitem" href="../../Visualization/">3D visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../tutorials/Algae/Algae/">Algae growth</a></li><li><a class="tocitem" href="../../../tutorials/Snowflakes/Snowflakes/">The Koch snowflake</a></li><li><a class="tocitem" href="../../../tutorials/Tree/Tree/">Tree</a></li><li><a class="tocitem" href="../../../tutorials/Forest/Forest/">Forest</a></li><li><a class="tocitem" href="../../../tutorials/GrowthForest/GrowthForest/">Growth forest</a></li><li><a class="tocitem" href="../../../tutorials/RaytracedForest/RaytracedForest/">Ray-traced forest</a></li><li><a class="tocitem" href="../../../tutorials/Context/Context/">Context sensitive rules</a></li><li><a class="tocitem" href="../../../tutorials/RelationalQueries/RelationalQueries/">Relational queries</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../api/graphs/">Graphs</a></li><li><a class="tocitem" href="../../../api/geometry/">Scenes and 3D meshes</a></li><li><a class="tocitem" href="../../../api/turtle/">Turtle geometry</a></li><li><a class="tocitem" href="../../../api/raytracer/">Ray tracing</a></li><li><a class="tocitem" href="../../../api/viz/">3D visualization</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">VPLVerse</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-5-1" type="checkbox"/><label class="tocitem" for="menuitem-5-1"><span class="docs-label">SkyDomes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../SkyDomes/">SkyDomes package</a></li><li><a class="tocitem" href="../../../SkyDomes/API/">SkyDomes API</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-2" type="checkbox"/><label class="tocitem" for="menuitem-5-2"><span class="docs-label">Ecophys</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Ecophys/">Ecophys package</a></li><li><a class="tocitem" href="../../../Ecophys/photosynthesis/">Photosynthesis API</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Turtle geometry and scenes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Turtle geometry and scenes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/VirtualPlantLab/VPLDocs/blob/master/docs/src/manual/Geometry/Turtle.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="manual_turtle"><a class="docs-heading-anchor" href="#manual_turtle">Turtle geometry and scenes</a><a id="manual_turtle-1"></a><a class="docs-heading-anchor-permalink" href="#manual_turtle" title="Permalink"></a></h1><p>Alejandro Morales</p><p>Centre for Crop Systems Analysis - Wageningen University</p><p>&lt;!– Explain the PlantGeomTurtle package –&gt;</p><h2 id="Meshes"><a class="docs-heading-anchor" href="#Meshes">Meshes</a><a id="Meshes-1"></a><a class="docs-heading-anchor-permalink" href="#Meshes" title="Permalink"></a></h2><p>The geometry in VPL consist of 3D triangular meshes. These meshes are used for 3D visualization and for ray tracing, buy may also be exported to external formats or used in other Julia packages. Most of the time, the geometry is generated from graphs using the concept of turtle geometry. In addition to generating the meshes, it will also be necessary to associated colors (for rendering) and material objects (for ray tracing) for each triangle in the mesh. All these components are then stored in a <code>Scene</code> object.</p><p>Meshes are collections of vertices, normal vectors and faces (which specify combinations of vertices that form triangles). They are implemented in the object <code>Mesh</code>. All vectors and points are represented by the type <code>Vec</code>. Any vector may be constructed by calling <code>Vec(x, y, z)</code> with the coordinates of the vector.</p><p>Meshes can be imported from external formats using the <a href="../../../api/geometry/#PlantGeomPrimitives.load_mesh-Tuple{Any}"><code>PlantGeomPrimitives.load_mesh()</code></a> function and exported using the <a href="../../../api/geometry/#PlantGeomPrimitives.save_mesh-Tuple{Any}"><code>PlantGeomPrimitives.save_mesh()</code></a> functions. The file formats supported include STL, OBJ and PLY (see documentation on functions for details).</p><p>Meshes are not meant to be modified directly by the user (unless adhoc geometry is needed). Instead, a series of functions are provided to generate meshes associated to different geometries. These functions are called <em>primitive constructors</em> and can be combined to generate more complex geometries. The primitive constructors maybe used to generate geometry procedurally with a turtle (see below), or to create the mesh directly (e.g., when adding geometry to an existing scene).</p><h2 id="Turtle-geometry"><a class="docs-heading-anchor" href="#Turtle-geometry">Turtle geometry</a><a id="Turtle-geometry-1"></a><a class="docs-heading-anchor-permalink" href="#Turtle-geometry" title="Permalink"></a></h2><p>The idea behind turtle geometry is to generate geometry procedurally by imagining a turtle that moves through the scene and is fed triangular meshes. This allows to generate any geometry by defining a sequence of instructions that the turtle will execute. These instructions are defined locally (e.g., turn right, move forward, etc.) and update the turtle position and orientation, such that a global geometry is generated after the instructions are executed.</p><p>The internal state of the turtle is defined by its position and three axis of rotation:</p><ul><li>Position (<code>pos</code>): The location of the turtle in the scene.</li><li>Heading (<code>head</code>): The direction in which the turtle is heading. Moving forward</li></ul><p>would mean moving along this direction. A rotation around the <code>head</code> vector is called a <em>roll</em> (imagine a turtle spinning on its head).</p><ul><li>Arm (<code>arm</code>): A direction perpendicular to <code>head</code> but on the same plane. A</li></ul><p>rotation around the <code>arm</code> vector is called a <em>pitch</em> (imagine a turtle turning up or down).</p><ul><li>Up (<code>up</code>): A direction perpendicular to the plane of the turtle. A rotation</li></ul><p>around the <code>up</code> vector is called a <em>yaw</em> (imagine a turtle turning left or right).</p><p>To generate geometry, that matches the morphology of a plant, the turtle in VPL is fed a graph. This means that the first instructions to the turtle will be given by the first node in the graph. The turtle will then traverse the entire graph, resetting its state at each branching point in the graph. The instructions to the turtle are given by methods of the <code>feed!()</code> function, defined for all the possible nodes in graph.</p><p>Two types of instructions are available to the turtle: movement operators and primitive constructors. The former are used to change the internal state of the turtle without adding geometry to the scene, while the latter generate a 3D mesh associated to a particular geometry (a special primitive constructor <code>Mesh!</code> accepts any mesh generated by the user). The different movement operators are given below, while the primitive constructors are given <a href="../Primitives/#manual_primitives">here</a>.</p><p>In addition, the turtle will contain a <code>message</code> field that can be assigned any user-defined value. This is useful to pass information to <code>feed!()</code> methods described below (e.g., to control the code executed by those methods). All the methods that create an internal turtle (e.g., <code>Scene</code> or <code>render</code>) will accept an optional <code>message</code> argument that will be passed on to the turtle.</p><h2 id="Movement-operators"><a class="docs-heading-anchor" href="#Movement-operators">Movement operators</a><a id="Movement-operators-1"></a><a class="docs-heading-anchor-permalink" href="#Movement-operators" title="Permalink"></a></h2><p>Movement operators as provided as functions that manipulate the state of the turtle in-place (e.g. <code>ra!</code>), as well as nodes that can be used inside a <code>Graph</code> object (e.g., <code>RA</code>). The functional version will be in lowercase, while the node version will be in uppercase. The functional version can be used inside any <code>feed!()</code> method, which reduces the number of nodes that need to be inserted into a graph.</p><p>Below are all the movement operators available in VPL (in their node form):</p><ul><li><a href="../../../api/turtle/#PlantGeomTurtle.T"><code>PlantGeomTurtle.T</code></a>: Move the turtle to a new absolute position.</li><li><a href="../../../api/turtle/#PlantGeomTurtle.RA"><code>PlantGeomTurtle.RA</code></a>: Rotate the turtle around the<code>arm</code> axis.</li><li><a href="../../../api/turtle/#PlantGeomTurtle.RH"><code>PlantGeomTurtle.RH</code></a>: Rotate the turtle around the <code>head</code> axis.</li><li><a href="../../../api/turtle/#PlantGeomTurtle.RU"><code>PlantGeomTurtle.RU</code></a>: Rotate the turtle around the <code>up</code> axis.</li><li><a href="../../../api/turtle/#PlantGeomTurtle.OR"><code>PlantGeomTurtle.OR</code></a>: Orient the turtle in a new direction by explicitly changing</li></ul><p>the <code>head</code>, <code>arm</code> and <code>up</code> vectors.</p><ul><li><a href="../../../api/turtle/#PlantGeomTurtle.F"><code>PlantGeomTurtle.F</code></a>: Move the turtle forward.</li><li><a href="../../../api/turtle/#PlantGeomTurtle.SET"><code>PlantGeomTurtle.SET</code></a>: Completely change the state of the turtle by setting the</li></ul><p><code>pos</code>, <code>head</code>, <code>arm</code> and <code>up</code> vectors.</p><ul><li><a href="../../../api/turtle/#PlantGeomTurtle.RV"><code>PlantGeomTurtle.RV</code></a>: A special rotation that emulates gravitropism (it rotates</li></ul><p>the turtle towards the Z axis of the scene).</p><h2 id="Scenes"><a class="docs-heading-anchor" href="#Scenes">Scenes</a><a id="Scenes-1"></a><a class="docs-heading-anchor-permalink" href="#Scenes" title="Permalink"></a></h2><p>A <code>Scene</code> object contains three elements that are connected:</p><ul><li>A triangular mesh (a <code>Mesh</code> object) that contains all the geometry of the</li></ul><p>scene.</p><ul><li>The colors associated to each triangle in the mesh (objects that inherit from</li></ul><p><code>Colorant</code> from the ColorTypes.jl package). This is needed for 3D rendering.</p><ul><li>The <code>Material</code> objects that defined the optical properties of each triangle.</li></ul><p>This is needed for ray tracing of radiation.</p><p>Only the first element is required to create a scene. The other two are optional and are only necessary if you want to render the scene or perform ray tracing on the scene.</p><h3 id="Creating-a-scene"><a class="docs-heading-anchor" href="#Creating-a-scene">Creating a scene</a><a id="Creating-a-scene-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-scene" title="Permalink"></a></h3><p>The simplest way to create a scene is to use the <code>Scene</code> constructor on a <code>Graph</code> object or a vector of <code>Graph</code> objects. This will create internally a <code>Turtle</code> which then generates the geometry, colors and materials of the scene via the <code>feed!()</code> methods defined by the user. VPL will take care of ensuring that triangles are connected to their corresponding colors and material objects.</p><p>A scene may also be created internally by <code>render()</code> when applied to a <code>Graph</code> object or a vector of <code>Graph</code> objects. However, this scene cannot be retrieved so it is not possible to modify it or reuse it for ray tracing. The ray tracer will not create a scene internally, so for that purpose the user will need to create the scene explicitly.</p><p>It is possible to add elements to an existing scene using the <code>add!()</code> method which allows to add a mesh to the scene (and optionally the corresponding colors and/or materials).</p><p>Multiple scenes can also be merged into a single one by calling <code>Scene()</code> on a vector of <code>Scene</code> objects. This allows for parallel construction of scenes which are then merged together.</p><h3 id="The-feed!()-method"><a class="docs-heading-anchor" href="#The-feed!()-method">The <code>feed!()</code> method</a><a id="The-feed!()-method-1"></a><a class="docs-heading-anchor-permalink" href="#The-feed!()-method" title="Permalink"></a></h3><p>In order to use the turtle to generate a scene from a graph, the user will need to define a <code>feed!()</code> method for each type of node stored in the graph (at least the ones that require geometry). This method will be called by the turtle when it encounters a node of that type. When no method is present, the turtle will simply move to the next node in the graph.</p><p>The <code>feed!()</code> method takes three arguments: the <code>Turtle</code>, the node and the graph- level variables (of the graph the node belongs to). The latter does not have to be used, but it may be useful if information at the plant level is required to generate geometry, colors or material objects (most often the information is stored inside the node itself). It is important that the second argument (the node) is annotated by its type and that the <code>PlantGeomTurtle</code> prefix is used to ensure that a method is created. For example, for a node of type <code>Internode</code> the function should be defined as:</p><pre><code class="language-julia hljs">function PlantGeomTurtle.feed!(t::Turtle, n::Internode, vars)
    &lt;code here&gt;
end</code></pre><p>Inside the <code>feed!()</code> method, the user can apply any of the movement operators described in the previous section as well as the turtle-specific primitive constructors (see section on <a href="../Primitives/#manual_primitives">Primitives</a>). All these changes will be applied to the turtle&#39;s internal state. The <code>feed!()</code> method should not return anything.</p><p>It is also possible to execute different code inside the <code>feed!()</code> method based on the <code>message</code> stored in the turtle. This allows for example to generate different geometries for visualizations and ray tracing, or to use different colors for visualization. Since the <code>message</code> can be any object created by the user, it may also be used to pass information to the <code>feed!()</code> method, though most often the relevant information is stored in the node or graph.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Primitives/">« Geometry primitives</a><a class="docs-footer-nextpage" href="../../Raytracer/">Ray tracing »</a><div class="flexbox-break"></div></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.1.0 on <span class="colophon-date" title="Wednesday 4 October 2023 07:54">Wednesday 4 October 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
